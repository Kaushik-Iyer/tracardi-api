{"file_name": "docs/installation/jobs/index.md", "questions": ["1. What is the purpose of the Heartbeat Job in Tracardi?", "2. How to run the Heartbeat Job with Docker?", "3. What are the environment variables for the Heartbeat Job Docker container?"], "answer": "# Tracardi Jobs\nTracardi utilizes jobs that can be initiated through Kubernetes (k8s) or set up as cronjobs. These jobs play crucial\nroles in the commercial Tracardi platform. The following jobs need to be started:\n\n1. **Heartbeat Job**: This job is responsible for closing sessions, marking profiles and sessions as inactive.\n   Heartbeats are periodic checks that identify certain patterns indicating inactivity. For example, if a session is not\n   closed, meaning there is no \"session closed\" event registered after a specific period of time from the last recorded\n   event, it indicates that the customer has left the page.\n\n2. **Segmentation Job**: This job executes segmentations on profiles based on predefined time intervals, such as hourly.\n   Workflow segmentations and conditional segmentations rely on this job. It requires the Segmentation Worker to be\n   running, as the job initiates the segmentation task, which is then completed by the Segmentation Worker.\n\n## Job Docker Containers\n\n### Heartbeat Job\n\nTo run the Heartbeat Job, use the following Docker command for the `tracardi/com-heartbeat-job` container:\n\n```bash\ndocker run \\\n-e ELASTIC_HOST=http://<elastic-ip>:9200 \\\n-e REDIS_HOST=redis://<redis-ip>:6379 \\\n-e REDIS_PASSWORD=password \\\n-e PRODUCTION=yes \\\n-e RANGE=now-1h|now \\\n-e SKIP_SECONDS=900 \\\n-e QUALIFY_BY=inactive-session \\\n-e EVENT_TYPE=session-inactive \\\ntracardi/com-heartbeat-job:0.8.1\n```\n\nDescription of environment variables:\n\n- `PRODUCTION`: Specifies whether the job should run on production data.\n- `RANGE`: Determines the number of records to fetch and search for the defined event types. It corresponds to the time\n  interval that the job runs. For example, if it runs every 1 hour, the time range should be larger than 1 hour.\n- `SKIP_SECONDS`: Represents the allowed time of inactivity after the last registered event for a profile.\n- `QUALIFY_BY`: Specifies the qualifying operation or pattern to match. In this case, \"inactive-session\" indicates that\n  the job searches for inactive sessions.\n- `EVENT_TYPE`: Defines the event type that must be registered if it qualifies for it.\n- `OPEN_EVENT_TYPE`: Defines the open event type that must be registered if it we want to close it with `CLOSE_EVENT_TYPE`.\n- `CLOSE_EVENT_TYPE`: Defines the close event type.\n\nEach job serves a specific purpose, and the provided example focuses on the Heartbeat Job, which looks for sessions\nwithout a `session-inactive` event within the time range of now and -1 hour. If there is no `session-inactive` event,\nthe job registers a \"Session Inactive\" event in the system.\n\nOther values for `QUALIFY_BY` include:\n\n- `inactive-profile`: Searches for inactive profiles, allowing users to define the time range and event type to trigger.\n- `inactive-session`: Looks for inactive sessions, indicating no events within the defined time frame.\n- `session-not-closed`: Searches for sessions that were not closed after a period of customer inactivity.\n\n\n#### Examples\n\nHere are the example Docker commands that you could run in cronjob:\n\n1. Session Inactive Job (SCHEDULE=\"*/8 * * * *\"):\n\n```bash\ndocker run \\\n-e ELASTIC_HOST=http://<elastic-ip>:9200 \\\n-e REDIS_HOST=redis://<redis-ip>:6379 \\\n-e REDIS_PASSWORD=password \\\n-e RANGE=\"now-1h|now\" \\\n-e QUALIFY_BY=\"inactive-session\" \\\n-e SKIP_SECONDS=900 \\\n-e EVENT_TYPE=\"session-inactive\" \\\ntracardi/com-heartbeat-job:0.8.1\n```\n\n2. Visit End Job (SCHEDULE=\"*/15 * * * *\"):\n\n```bash\ndocker run \\\n-e ELASTIC_HOST=http://<elastic-ip>:9200 \\\n-e REDIS_HOST=redis://<redis-ip>:6379 \\\n-e REDIS_PASSWORD=password \\\n-e RANGE=\"now-1h|now\" \\\n-e QUALIFY_BY=\"session-not-closed\" \\\n-e SKIP_SECONDS=1800 \\\n-e OPEN_EVENT_TYPE=\"visit-started\" \\\n-e CLOSE_EVENT_TYPE=\"visit-ended\" \\\ntracardi/com-heartbeat-job:0.8.1\n```\n\n3. Inactive Profile Job (SCHEDULE=\"13 4 1 * *\"):\n\n```bash\ndocker run \\\n-e ELASTIC_HOST=http://<elastic-ip>:9200 \\\n-e REDIS_HOST=redis://<redis-ip>:6379 \\\n-e REDIS_PASSWORD=password \\\n-e RANGE=\"now-1y|now\" \\\n-e QUALIFY_BY=\"inactive-", "hash": "84f6319a8d0180defdd84a11e69312004e545b92"}